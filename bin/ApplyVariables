#!/usr/bin/env bash

### Imports ###################################################################

source ScriptFunctions
Import OptionParser

### Options ###################################################################

helpOnNoArguments='yes'
scriptNotes="${scriptName} processes a file replacing instances of variables marked
with special indicators ('@%', '%@' by default) with the contents of equivalent
environment variables."
Add_Option_Entry 'o' 'open' 'Opening mark.' '@%'
Add_Option_Entry 'c' 'close' 'Closing mark.' '%@'
Add_Option_Entry 'i' 'identifier' 'Add a prefix identifier in the form of '\''<entry>_'\'' to the opening markup.'
Parse_Options "$@"

### Operation #################################################################

open=$(Entry 'open')       # opening brace (default '@%')
close=$(Entry 'close')     # closing brace (default '%@')
if Is_Entry 'identifier'   # variable name prefix (default '')
then
   open="${open}$(Entry identifier)_"
fi
filename=$(Arg 1)          # source filename

# read contents of the ${filename} file
# find/expand enviornment variables in contents
# output expanded results to stdout
if ! ApplyVariablesCore "${open}" "${close}" "${filename}"
then
   # if the function returns an error (commonly, if the file doesn't exist)
   # throw an error and abort
   Die "${filename}: failed"
fi

